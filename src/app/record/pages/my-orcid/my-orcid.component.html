<main id="main">
  <ng-container *ngIf="!userNotFound">
    <app-top-bar-my-public-record-preview
      [isPublicRecord]="publicOrcid"
      [newRecordHeaderTogglz]="newRecordHeaderTogglz"
    ></app-top-bar-my-public-record-preview>
    <app-record-header
      *ngIf="!!publicOrcid && newRecordHeaderTogglz"
      [loadingUserRecord]="loadingUserRecord"
      [isPublicRecord]="publicOrcid"
      [affiliations]="affiliations"
      [(recordSummaryOpen)]="recordSummaryOpen"
      [newRecordHeaderWithSummaryTogglz]="newRecordHeaderWithSummaryTogglz"
    ></app-record-header>
    <div
      class="container no-padding main-content"
      [ngClass]="{
        'main-content-shadow': recordSummaryOpen
      }"
    >
      <div class="row">
        <app-side-bar
          class="col l3 m8 s4"
          [ngClass]="{ 'new-header': newRecordHeaderTogglz }"
          [isPublicRecord]="publicOrcid"
          [orcidId]="platform.columns8 || platform.columns4"
          [newRecordHeaderTogglz]="newRecordHeaderTogglz"
          [loadingUserRecord]="loadingUserRecord"
          (isSideBarEmpty)="isSideBarEmpty($event)"
          *ngIf="
            !loadingUserRecord && newRecordHeaderTogglz
              ? publicOrcid
                ? !recordWithIssues &&
                  (displaySideBar || displayBiography || affiliations > 0)
                : true
              : true
          "
        >
        </app-side-bar>
        <div
          class="content"
          [ngClass]="{
            'col l9 m8 s4':
              !loadingUserRecord && newRecordHeaderTogglz
                ? publicOrcid
                  ? !recordWithIssues &&
                    (displaySideBar || displayBiography || affiliations > 0)
                  : true
                : true
          }"
        >
          <app-main>
            <app-top-bar
              [isPublicRecord]="publicOrcid"
              class="row"
              [loadingUserRecord]="loadingUserRecord"
              [newRecordHeaderTogglz]="newRecordHeaderTogglz"
            ></app-top-bar>
            <app-side-bar
              class="col l3 m8 s4"
              [ngClass]="{
                'new-header': newRecordHeaderTogglz,
                'side-bar-mobile': newRecordHeaderTogglz
              }"
              [isPublicRecord]="publicOrcid"
              [hideOrcidId]="true"
              *ngIf="platform.columns8 || platform.columns4"
            >
            </app-side-bar>
            <ng-container *ngIf="!recordWithIssues">
              <section
                id="activities"
                role="region"
                [attr.aria-label]="regionActivities"
              >
                <div
                  class="activities"
                  *ngIf="!(publicOrcid && affiliations === 0)"
                >
                  <h2
                    class="activities-header orc-font-body col"
                    i18n="@@shared.activities"
                  >
                    Activities
                  </h2>
                  <div class="expand-buttons">
                    <button
                      mat-button
                      color="primary"
                      type="button"
                      i18n="@@shared.expandAll"
                      (click)="switchPanelsState()"
                      *ngIf="!globalExpandState"
                      [attr.aria-label]="expandAllActivitiesArialLabel"
                    >
                      Expand all
                    </button>
                    <button
                      mat-button
                      color="primary"
                      type="button"
                      i18n="@@shared.collapseAll"
                      (click)="switchPanelsState()"
                      *ngIf="globalExpandState"
                      [attr.aria-label]="collapseAllActivitiesArialLabel"
                    >
                      Collapse all
                    </button>
                  </div>
                </div>
                <app-affiliations
                  [userInfo]="userInfo"
                  [isPublicRecord]="publicOrcid"
                  [expandedContent]="expandedContent"
                  (expandedContentChange)="expandedContentUpdate($event)"
                  (total)="affiliationsCount($event)"
                  id="cy-affiliations"
                ></app-affiliations>
                <app-fundings
                  [userInfo]="userInfo"
                  [isPublicRecord]="publicOrcid"
                  [expandedContent]="expandedContent"
                  (expandedContentChange)="expandedContentUpdate($event)"
                  (total)="affiliationsCount($event)"
                  id="cy-fundings"
                ></app-fundings>
                <app-research-resources
                  [isPublicRecord]="publicOrcid"
                  [expandedContent]="expandedContent"
                  (expandedContentChange)="expandedContentUpdate($event)"
                  (total)="affiliationsCount($event, 'RESEARCH_RESOURCE')"
                  id="cy-research-resources"
                ></app-research-resources>
                <app-work-stack-group
                  [userInfo]="userInfo"
                  [isPublicRecord]="publicOrcid"
                  [expandedContent]="expandedContent"
                  (expandedContentChange)="expandedContentUpdate($event)"
                  (total)="affiliationsCount($event)"
                  id="cy-works"
                ></app-work-stack-group>
                <app-peer-reviews
                  [userInfo]="userInfo"
                  [isPublicRecord]="publicOrcid"
                  [expandedContent]="expandedContent"
                  (expandedContentChange)="expandedContentUpdate($event)"
                  (total)="affiliationsCount($event)"
                  id="cy-peer-reviews"
                ></app-peer-reviews>
              </section>
            </ng-container>
            <ng-container
              *ngIf="
                !newRecordHeaderTogglz
                  ? !(recordWithIssues || loadingUserRecord)
                  : false
              "
            >
              <div
                class="no-public-info"
                *ngIf="publicOrcid && affiliations === 0"
              >
                <mat-icon>error</mat-icon>
                <ng-container i18n="@@record.noPublicInfo"
                  >No public information available.
                </ng-container>
              </div>
              <div
                class="orc-font-body-small"
                *ngIf="
                  publicOrcid &&
                  userRecord?.lastModifiedTime &&
                  !newRecordHeaderTogglz
                "
                [ngClass]="{ 'last-modified': affiliations === 0 }"
              >
                <i>
                  <span i18n="@@shared.lastModifiedTime">
                    Record last modified
                  </span>
                  {{ userRecord?.lastModifiedTime | date : 'medium' : 'UTC' }}
                  UTC
                </i>
              </div>
            </ng-container>
            <app-record-info
              *ngIf="
                publicOrcid && newRecordHeaderTogglz
                  ? recordWithIssues ||
                    (!loadingUserRecord && affiliations === 0)
                  : false
              "
              [isPublicRecord]="publicOrcid"
              [displaySideBar]="displaySideBar"
              [displayBiography]="displayBiography"
              [affiliations]="affiliations"
            ></app-record-info>
            <app-statistics
              [ngClass]="{ mobile: !platform.columns12 }"
            ></app-statistics>
          </app-main>
        </div>
      </div>
    </div>
  </ng-container>
  <app-not-found *ngIf="userNotFound"></app-not-found>
</main>

<form [formGroup]="twoFactorForm" (ngSubmit)="onSubmit()">
  <p i18n="@@ngOrcid.signin.2fa.heading" *ngIf="!signInUpdatesV1Togglz">
    Two-factor authentication
  </p>
  <div [ngClass]="{ 'input-container': signInUpdatesV1Togglz }">
    <mat-label
      class="orc-font-small-print"
      i18n="@@ngOrcid.signin.2fa.label"
      [ngClass]="{
        error: isVerificationCodeInvalid
      }"
      *ngIf="!recoveryCode && signInUpdatesV1Togglz"
      >Two-factor authentication code
    </mat-label>
    <mat-form-field
      appearance="outline"
      class="row deactivate"
      *ngIf="!recoveryCode"
    >
      <mat-label
        i18n="@@ngOrcid.signin.2fa.label"
        *ngIf="!signInUpdatesV1Togglz"
      >
        Two-factor authentication code
      </mat-label>
      <input
        matInput
        #inputVerificationCode
        formControlName="verificationCode"
        cdkFocusInitial
        appTrim
        autocomplete="off"
      />
      <mat-hint align="end" *ngIf="!signInUpdatesV1Togglz"
        >{{ inputVerificationCode.value?.length || 0 }}/6</mat-hint
      >
      <mat-error
        *ngIf="
          !signInUpdatesV1Togglz && verificationFormControl.hasError('required')
        "
      >
        <p
          i18n="@@ngOrcid.signin.2fa.verificationCodeRequired"
          class="error-message"
        >
          Authentication code is required
        </p>
        <p class="error-length">
          {{ inputVerificationCode.value?.length || 0 }}/6
        </p>
      </mat-error>

      <mat-error
        *ngIf="
          !signInUpdatesV1Togglz &&
          (verificationFormControl.hasError('minlength') ||
            verificationFormControl.hasError('maxlength'))
        "
      >
        <p
          i18n="@@ngOrcid.signin.2fa.badVerificationCodeLength"
          class="error-message"
        >
          Invalid authentication code length
        </p>
        <p class="error-length">
          {{ inputVerificationCode.value?.length || 0 }}/6
        </p>
      </mat-error>
    </mat-form-field>
    <ng-container *ngIf="signInUpdatesV1Togglz && !recoveryCode">
      <mat-hint
        class="orc-font-small-print error-length"
        *ngIf="!isVerificationCodeInvalid"
        >{{ verificationFormControl.value?.length || 0 }}/6</mat-hint
      >
      <mat-error
        *ngIf="
          verificationWasTouched && verificationFormControl.hasError('required')
        "
      >
        <p
          i18n="@@ngOrcid.signin.2fa.verificationCodeRequired"
          class="error-message"
        >
          Authentication code is required
        </p>
        <p class="error-length">
          {{ verificationFormControl.value?.length || 0 }}/6
        </p>
      </mat-error>

      <mat-error
        *ngIf="
          verificationWasTouched &&
          (verificationFormControl.hasError('minlength') ||
            verificationFormControl.hasError('maxlength'))
        "
      >
        <p
          i18n="@@ngOrcid.signin.2fa.badVerificationCodeLength"
          class="error-message"
        >
          Invalid authentication code length
        </p>
        <p class="error-length">
          {{ verificationFormControl.value?.length || 0 }}/6
        </p>
      </mat-error>
    </ng-container>
  </div>
  <p
    [ngClass]="{
      'enter-code': signInUpdatesV1Togglz && isVerificationCodeInvalid
    }"
  >
    <a
      [ngClass]="{
        'mat-button-font': !signInUpdatesV1Togglz,
        underline: signInUpdatesV1Togglz,
        'orc-font-body-small': signInUpdatesV1Togglz
      }"
      (click)="showAuthenticationCode()"
      i18n="@@ngOrcid.signin.2fa.instructionsPart1"
      >Enter a code
    </a>
    <ng-container i18n="@@ngOrcid.signin.2fa.instructionsPart2">
      from your two-factor authentication app
    </ng-container>
  </p>
  <p>
    <ng-container i18n="@@ngOrcid.signin.2fa.noDevice1">
      Don't have your device?
    </ng-container>
    <a
      [ngClass]="{
        'mat-button-font': !signInUpdatesV1Togglz,
        underline: signInUpdatesV1Togglz,
        'orc-font-body-small': signInUpdatesV1Togglz
      }"
      (click)="showRecoveryCode()"
      i18n="@@ngOrcid.signin.2fa.noDevice2"
      >Enter a recovery code
    </a>
  </p>
  <p>
    <ng-container i18n="@@ngOrcid.signin.2fa.noDeviceOrRecovery">
      Don't have your device or recovery code?
    </ng-container>
    <a
      [ngClass]="{
        'mat-button-font': !signInUpdatesV1Togglz,
        underline: signInUpdatesV1Togglz,
        'orcid-orc-font-body-small': signInUpdatesV1Togglz
      }"
      (click)="navigateTo('https://support.orcid.org/')"
      rel="noopener noreferrer"
      target="_blank"
      i18n="@@shared.orcidHelpCenter"
      >ORCID Help Center
    </a>
  </p>
  <div [ngClass]="{ 'input-container': signInUpdatesV1Togglz }">
    <mat-label
      class="orc-font-small-print"
      i18n="@@ngOrcid.signin.2fa.recoveryCode"
      [ngClass]="{
        error: isRecoveryCodeInvalid
      }"
      *ngIf="recoveryCode && signInUpdatesV1Togglz"
      >Recovery code
    </mat-label>
    <mat-form-field
      appearance="outline"
      class="row"
      [ngClass]="{ 'two-factor': !signInUpdatesV1Togglz }"
      *ngIf="recoveryCode"
    >
      <mat-label
        i18n="@@ngOrcid.signin.2fa.recoveryCode"
        *ngIf="!signInUpdatesV1Togglz"
      >
        Recovery code
      </mat-label>
      <input
        matInput
        #inputRecoveryCode
        formControlName="recoveryCode"
        appTrim
        autocomplete="off"
      />
      <mat-hint align="end" *ngIf="!signInUpdatesV1Togglz"
        >{{ inputRecoveryCode.value?.length || 0 }}/10</mat-hint
      >
      <mat-error
        *ngIf="
          !signInUpdatesV1Togglz && recoveryCodeFormControl.hasError('required')
        "
      >
        <p
          i18n="@@ngOrcid.signin.2fa.recoveryCodeRequired"
          class="error-message"
        >
          Recovery code is required
        </p>
        <p class="error-length">
          {{ inputRecoveryCode.value?.length || 0 }}/10
        </p>
      </mat-error>

      <mat-error
        *ngIf="
          !signInUpdatesV1Togglz &&
          (recoveryCodeFormControl.hasError('minlength') ||
            recoveryCodeFormControl.hasError('maxlength'))
        "
      >
        <p
          i18n="@@ngOrcid.signin.2fa.badRecoveryCodeLength"
          class="error-message"
        >
          Invalid recovery code length
        </p>
        <p class="error-length">
          {{ inputRecoveryCode.value?.length || 0 }}/10
        </p>
      </mat-error>
    </mat-form-field>
    <ng-container *ngIf="signInUpdatesV1Togglz && recoveryCode">
      <mat-hint
        class="orc-font-small-print error-length"
        *ngIf="!isRecoveryCodeInvalid"
        >{{ recoveryCodeFormControl.value?.length || 0 }}/10</mat-hint
      >
      <mat-error
        *ngIf="
          recoveryCodeWasTouched && recoveryCodeFormControl.hasError('required')
        "
      >
        <p
          i18n="@@ngOrcid.signin.2fa.recoveryCodeRequired"
          class="error-message"
        >
          Recovery code is required
        </p>
        <p class="error-length">
          {{ recoveryCodeFormControl.value?.length || 0 }}/10
        </p>
      </mat-error>

      <mat-error
        *ngIf="
          recoveryCodeWasTouched &&
          (recoveryCodeFormControl.hasError('minlength') ||
            recoveryCodeFormControl.hasError('maxlength'))
        "
      >
        <p
          i18n="@@ngOrcid.signin.2fa.badRecoveryCodeLength"
          class="error-message"
        >
          Invalid recovery code length
        </p>
        <p class="error-length">
          {{ recoveryCodeFormControl.value?.length || 0 }}/10
        </p>
      </mat-error>
    </ng-container>
  </div>

  <button
    mat-raised-button
    class="row mat-elevation-z0 two-factor"
    type="submit"
    i18n="@@ngOrcid.signin.2fa.authenticate"
    id="authenticateButton"
    [ngClass]="{
      'authenticate-button': !signInUpdatesV1Togglz,
      'authenticate-button-new-signin': signInUpdatesV1Togglz
    }"
  >
    AUTHENTICATE
  </button>
</form>
<mat-error *ngIf="showBadVerificationCode" class="orcid-error">
  <mat-icon inline="true">error</mat-icon>
  <ng-container i18n="@@ngOrcid.signin.2fa.badVerificationCode">
    Invalid authentication code
  </ng-container>
</mat-error>
<mat-error *ngIf="showBadRecoveryCode" class="orcid-error">
  <mat-icon inline="true">error</mat-icon>
  <ng-container i18n="@@ngOrcid.signin.2fa.badRecoveryCode">
    Invalid recovery code
  </ng-container>
</mat-error>
